(()=>{"use strict";var a={pluginUrl:besnr.plugin_url,pluginDomain:besnr.plugin_domain,ajaxUrl:besnr.ajax_url,ajaxNonce:besnr.ajax_nonce},i={ajaxRequest:function(e,t,n,r){jQuery.ajax({method:"post",url:a.ajaxUrl,data:jQuery.extend({action:e,_wpnonce:a.ajaxNonce},n),beforeSend:function(){return i.beforeSendCallback(t)},success:function(e){return r(JSON.parse(e)[0])},complete:function(){return i.completeCallback(t)},error:function(){return i.errorCallback(t)}})},beforeSendCallback:function(e){e.find(".besnr-loading-bar").show()},completeCallback:function(e){e.find(".besnr-loading-bar").hide()},errorCallback:function(e){var e=e.find(".besnr-output").empty(),t='<storng>Internal Server Error!</strong><br />Contact your hosting provider and access your logs to learn more about what is causing the error; then the plugin author with the detials @ <a href="mailto:contact@'.concat(a.pluginDomain,'">contact@').concat(a.pluginDomain,"</a>.");e.addClass("besnr-output-active besnr-output-active-error"),e.html(t)},outputCallback:function(e,t,n){e=e.find(".besnr-output").empty();e.removeClass("besnr-output-active-success besnr-output-active-error").addClass("besnr-output-active-"+(1===t?"success":"error")),e.addClass("besnr-output-active").show().html(n)}},s={highlightSearchText:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"classic",n=(e.preventDefault(),jQuery(e.target).closest(".besnr-admin")),e={current_post_id:n.find('input[name="besnr-current-post-id"]').val(),search_input:n.find('[name="besnr-search-input"]').val(),search_method:n.find('select[name="besnr-search-method"]').val(),is_dry_run:n.find('input[name="besnr-dry-run"]:checked').length,is_highlighted:n.find('input[name="besnr-highlight-search"]:checked').length,is_case_sensitive:n.find('input[name="besnr-case-sensitive"]:checked').length};i.ajaxRequest("besnr_highlight_search",n,e,function(e){2===e.status&&(s.updateEditorContents(e,n,t),n.find('button[name="besnr-preview-changes"]').hide()),i.outputCallback(n,1,e.message)})},defaultSearchReplace:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"classic",n=(e.preventDefault(),jQuery(e.target).closest(".besnr-admin")),r=n.find('select[name="besnr-search-method"]').val(),e={current_post_id:n.find('input[name="besnr-current-post-id"]').val(),search_input:n.find('[name="besnr-search-input"]').val(),replace_with_input:n.find('[name="besnr-replace-with-input"]').val(),search_method:r,is_highlighted:n.find('input[name="besnr-highlight-search"]:checked').length,is_case_sensitive:n.find('input[name="besnr-case-sensitive"]:checked').length};i.ajaxRequest("besnr_default_search_replace",n,e,function(e){s.updateEditorContents(e,n,t),n.find('select[name="besnr-search-method"]').val(r),n.find('[name="besnr-search-input"]').val(""),n.find('[name="besnr-replace-with-input"]').val("")})},removeHighlightTags:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"classic",n=(e.preventDefault(),jQuery(e.target).closest(".besnr-admin")),e={current_post_id:n.find('input[name="besnr-current-post-id"]').val()};i.ajaxRequest("besnr_remove_highlight_tags",n,e,function(e){s.updateEditorContents(e,n,t),n.find('[name="besnr-search-input"]').val(""),n.find('[name="besnr-replace-with-input"]').val("")})},updateEditorContents:function(e,t,n){var r={current_post_id:t.find('input[name="besnr-current-post-id"]').val()};0!==e.status&&1!==e.status||i.outputCallback(t,e.status,e.message),i.ajaxRequest("besnr_update_editor_contents",t,r,function(e){var t;e&&!1===e.success||2!==e.status||(e=(new DOMParser).parseFromString(e.message,"text/html").documentElement.textContent,"classic"===n?(t=jQuery("<style/>").html("besnr-highlight { background-color: #87ceeb; padding: 3px; }"),jQuery("#content_ifr").contents().find("head").append(t),jQuery("#content_ifr").contents().find("body").empty().html(e)):(0,window.wp.data.dispatch)("core/editor").editPost({content:e}))})}},c={},o={inputProps:{},highlightSearch:!0,caseSensitive:!1,besnrMethod:"text"};c.init=function(){var e,t,n,r;c.updateInputProps(),1==document.querySelector('input[name="besnr-classic-editor"]').value&&(e=document.querySelector('textarea[name="besnr-search-input"]'),t=document.querySelector('button[name="besnr-preview-changes"]'),n=document.querySelector('button[name="besnr-default-search-replace"]'),r=document.querySelector('button[name="besnr-remove-highlight-tags"]'),e&&e.addEventListener("blur",c.highlightSearch),t&&t.addEventListener("click",s.previewChanges),n&&n.addEventListener("click",s.defaultSearchReplace),r)&&r.addEventListener("click",s.removeHighlightTags)},c.updateInputProps=function(){switch(o.besnrMethod){case"text":o.inputProps={searchPlaceholder:"Enter your search phrase...",replacePlaceholder:"Enter your replace with phrase...",inputType:"textarea",highlight:!0,caseSensitive:!0,dryRun:!0};break;case"url":o.inputProps={searchPlaceholder:"Enter URL to search...",replacePlaceholder:"Enter your replacement URL...",inputType:"textarea",dryRun:!0,highlight:!0,caseSensitive:!1};break;case"image":o.inputProps={searchPlaceholder:"Enter image URL to search...",replacePlaceholder:"Enter your replacement image URL...",inputType:"textarea",dryRun:!0,highlight:!0,caseSensitive:!1};break;case"multiple":o.inputProps={searchPlaceholder:"Enter multiple terms, separated by commas...",replacePlaceholder:"Enter your replacement terms...",inputType:"textarea",dryRun:!0,highlight:!0,caseSensitive:!0};break;default:console.warn("Unknown search method.")}var e=document.getElementById("besnr-search-input"),t=document.getElementById("besnr-replace-with-input");e&&(e.placeholder=o.inputProps.searchPlaceholder),t&&(t.placeholder=o.inputProps.replacePlaceholder),document.getElementById("besnr-highlight-search").addEventListener("change",c.toggleHighlightSearch),document.getElementById("besnr-case-sensitive").addEventListener("change",c.toggleCaseSensitive),document.getElementById("besnr-search-method").addEventListener("change",c.changeSearchMethod)},c.toggleHighlightSearch=function(e){e=e.target;o.highlightSearch=e.checked},c.toggleCaseSensitive=function(e){e=e.target;o.caseSensitive=e.checked},c.changeSearchMethod=function(e){o.besnrMethod=e.target.value,c.updateInputProps();var t=document.getElementById("besnr-search-input"),n=document.getElementById("besnr-replace-with-input"),r=document.querySelector('input[name="besnr-highlight-search"]').closest("p"),a=document.querySelector('input[name="besnr-case-sensitive"]').closest("p");r.style.display=o.inputProps.highlight?"block":"none",a.style.display=o.inputProps.caseSensitive?"block":"none","image"===e.target.value?(t.addEventListener("click",c.openMediaWindow),n.addEventListener("click",c.openMediaWindow)):(t.removeEventListener("click",c.openMediaWindow),n.removeEventListener("click",c.openMediaWindow))},c.highlightSearch=function(e){s.highlightSearchText(e)},c.openMediaWindow=function(e){var t,n=jQuery(e.target);t||(jQuery('div[id^="__wp-uploader-id"]').remove(),(t=wp.media.frames.meta_image_frame=wp.media({title:"Block Editor S/R (Images)",button:{text:"Select Image"}})).on("select",function(){var e=t.state().get("selection").first().toJSON();n.val(e.url)})),t.open()},jQuery,c.init()})();